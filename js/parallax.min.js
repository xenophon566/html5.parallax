/**
* My Parallax Plugin
* 
* @Date 	20130909
* @Author 	ShawnWu
* @Version 	release v6.6.20140320
* @License 	under the MIT License
**/
jQuery.fn.parallScroll=function(d,A){d=jQuery.extend({useEasing:!0,interval:25,scrollLimit:8E3,scrollRatio:500,naviRatio:800,naviLocate:{},scrollAxis:"x",horiScroll:!0,vertiScroll:!0,response:!1,parallaxB:!0,parallaxE:!0,hideElem:!0,hideType:function(d){d.hide()},showType:function(d){d.show()},refValueW:$(window).width(),refValueH:$(window).height(),navId:"#navi",formula:function(d,t){return Math.round(d/t*100)/100}},d);var z=new function(){var u=(-1!=navigator.userAgent.search("Firefox")?"-moz":
-1!=navigator.userAgent.search("MSIE")?"-ms":-1!=navigator.userAgent.search("Opera")?"-o":"-webkit")+"-transform",t=$(window),r=$("body"),l=$(A),v=$(d.navId),y="x"==d.scrollAxis?d.refValueW:d.refValueH,x="x"==d.scrollAxis?t.width():t.height(),h=d.formula(x,y);t.resize(function(){x="x"==d.scrollAxis?t.width():t.height();h=d.formula(x,y)});d.scrollLimit*=h;d.scrollRatio*=h;d.naviRatio*=h;var w="x"==d.scrollAxis?t.width():t.height();this.init=function(){z.parallax.init_parallax()};this.parallax=new function(){this.iScrollInterval=
this.iScrollInstance=null;this.useEasing=d.useEasing;this.naviLoc=d.naviLocate;var s=this.scrollPos=0;this.init_parallax=function(){var b=this;v.find("li a").click(function(){s=d.naviLocate[$(this).attr("id")];b.naviClick($(this).attr("id"))});$.stellar({horizontalScrolling:d.horiScroll,verticalScrolling:d.vertiScroll,responsive:d.response,parallaxBackgrounds:d.parallaxB,parallaxElements:d.parallaxE,hideDistantElements:d.hideElem,hideElement:d.hideType,showElement:d.showType,refWidth:t.width(),refHeight:t.height(),
formula:d.formula});l.mousewheel(function(m,c){m.preventDefault();m.stopPropagation();b.scrollPos=0>b.scrollPos-c*d.interval?0:b.scrollPos-c*d.interval||0;b.scrollPos=b.scrollPos>d.scrollLimit?d.scrollLimit:b.scrollPos;1>c&&-1<c&&(b.useEasing=!1);b.scrollEasing(b.useEasing)});$(document).on("keyup keypress keydown",l,function(m){m.stopPropagation();if(37==m.keyCode||38==m.keyCode)var c=1;if(39==m.keyCode||40==m.keyCode)c=-1;~[37,38,39,40].indexOf(m.keyCode)&&(b.scrollPos=0>b.scrollPos-c*d.interval?
0:b.scrollPos-c*d.interval||0,b.scrollPos=b.scrollPos>d.scrollLimit?d.scrollLimit:b.scrollPos,b.scrollEasing(b.useEasing))});b.scrollEasing=function(m){if(m){var c=0;"x"==d.scrollAxis?r.stop(!0,!1).animate({scrollLeft:b.scrollPos},{duration:d.scrollRatio,step:function(){var a=r.scrollLeft()?r.scrollLeft():l.scrollLeft();a!=c&&(b.scrollUpdate(a),c=a)}}):r.stop(!0,!1).animate({scrollTop:b.scrollPos},{duration:d.scrollRatio,step:function(){var a=r.scrollLeft()?r.scrollLeft():l.scrollLeft();a!=c&&(b.scrollUpdate(a),
c=a)}})}else"x"==d.scrollAxis?r.scrollLeft(b.scrollPos):r.scrollTop(b.scrollPos),b.scrollUpdate(b.scrollPos)}};this.scrollUpdate=function(b,d,c){this.aniHandler(b);c||this.naviScroll(b)};this.aniHandler=function(b){var m=this.scrollPos;b>=s*h-5&&b<=s*h+5&&(s=0);l.find("[data-rotate]").each(function(){var c=$(this).data("rotate"),a=$(this).data("init-rotate"),d=+c.speed||5,c=+c.direct?1*d:-1*d,a=+a.rotate||0,a=0<m-b?(a+c)%360:0>m-b?(a-c)%360:(a+c)%360;rotateAngle="rotate("+a+"deg)";$(this).next().css(u,
rotateAngle);$(this).data("init-rotate",{rotate:a})});l.find("[data-scale]").each(function(){var c=$(this).data("scale"),a=$(this).data("init-scale"),d=+c.speed*h||100,f=+c.resize||1,g=+c.direct||0,q=+c.max||5,p=+c.min||1,k=+c.sdist*h||0,c=+c.edist*h||w,e=+a.dist*h||0,a=+a.scale||1;0<m-b?b>k&&b<k+c&&b>e&&(a=g?a-f:a+f,a>q&&(a=q),a<p&&(a=p),scaleSize="scale("+a+")",e+=d,$(this).next().css(u,scaleSize)):0>m-b?b>k&&b<k+c&&b<e&&(a=g?a+f:a-f,a>q&&(a=q),a<p&&(a=p),scaleSize="scale("+a+")",e-=d,$(this).next().css(u,
scaleSize)):b>k&&b<k+c&&(s&&b>e?(a=g?a-f:a+f,a>q&&(a=q),a<p&&(a=p),scaleSize="scale("+a+")",e+=d,$(this).next().css(u,scaleSize)):s&&b<e&&(a=g?a+f:a-f,a>q&&(a=q),a<p&&(a=p),scaleSize="scale("+a+")",e-=d,$(this).next().css(u,scaleSize)));e/=h;$(this).data("init-scale",{dist:e,scale:a})});l.find("[data-frame]").each(function(){var c=$(this).data("frame"),a=$(this).data("init-frame"),d=+c.speed*h||100,f=+c.sdist*h||0,c=+c.edist*h||w,g=+a.dist*h||0,q=+$(this).nextAll().length,p=+a.now||0,k=+a.next||0;
0<m-b?b>f&&b<f+c&&b>g&&k<q-1&&(k++,g+=d,$(this).data("init-frame",{dist:g,next:k})):0>m-b?b>f&&b<f+c&&b<g&&1<=k&&(k--,g-=d,$(this).data("init-frame",{dist:g,next:k})):b>f&&b<f+c&&(s&&b>g?k<q-1&&(k++,g+=d,$(this).data("init-frame",{dist:g,next:k})):s&&b<g&&1<=k&&(k--,g-=d,$(this).data("init-frame",{dist:g,next:k})));k!=p&&($(this).siblings().css("display","none"),$(this).nextAll().each(function(a){a==k&&$(this).css("display","block")}),p=k,g/=h,$(this).data("init-frame",{dist:g,now:p,next:k}))});l.find("[data-mask]").each(function(){var c=
$(this).data("mask"),a=$(this).data("init-mask"),d=+c.speed*h||100,f=+c.clip||10,g=+c.direct||0,q=+c.axis||0,p=+c.sdist*h||0,c=+c.edist*h||w,a=+a.dist*h||0,k=$(this).next().length?$(this).next():$(this),e=+k.width(),l=+$(this).parent().width(),n=+k.height(),r=+$(this).parent().height();0<m-b?b>p&&b<p+c&&b>a&&(q?n=g?n+f:n-f:e=g?e-f:e+f,e>l&&(e=l),0>e&&(e=0),n>r&&(n=r),0>n&&(n=0),a+=d):0>m-b?b>p&&b<p+c&&b<a&&(q?n=g?n-f:n+f:e=g?e+f:e-f,e>l&&(e=l),0>e&&(e=0),n>r&&(n=r),0>n&&(n=0),a-=d):b>p&&b<p+c&&(s&&
b>a?(q?n=g?n+f:n-f:e=g?e-f:e+f,e>l&&(e=l),0>e&&(e=0),n>r&&(n=r),0>n&&(n=0),a+=d):s&&b<a&&(q?n=g?n-f:n+f:e=g?e+f:e-f,e>l&&(e=l),0>e&&(e=0),n>r&&(n=r),0>n&&(n=0),a-=d));k.css({width:e,height:n});a/=h;$(this).data("init-mask",{dist:a})});l.find("[data-sprite]").each(function(){var c=$(this).data("sprite"),a=+c.speed||100,d=+c.direct||0,c=+c.axis||0,f=$(this).css("background-position").split(" "),g=+f[0].replace(/[^0-9-]/g,""),f=+f[1].replace(/[^0-9-]/g,"");0<m-b?c?f=d?f+a:f-a:g=d?g-a:g+a:0>m-b?c?f=d?
f-a:f+a:g=d?g+a:g-a:c?f=d?f+a:f-a:g=d?g-a:g+a;$(this).css("background-position",g+"px "+f+"px")});l.find("[data-move]").each(function(){var c=$(this).data("move"),a=$(this).data("init-move"),l=+c.speed*h||100,f=+c.moving*h||10,g=+c.direct||0,q=+c.max*h||100,p=+c.min*h||0,k=+c.sdist*h||0,c=+c.edist*h||w,e=+a.dist*h||0,a=+a.posi*h||0;0<m-b?b>k&&b<k+c&&b>e&&(a=g?a+f:a-f,a>q&&(a=q),a<p&&(a=p),e+=l):0>m-b?b>k&&b<k+c&&b<e&&(a=g?a-f:a+f,a>q&&(a=q),a<p&&(a=p),e-=l):b>k&&b<k+c&&(s&&b>e?(a=g?a+f:a-f,a>q&&(a=
q),a<p&&(a=p),e+=l):s&&b<e&&(a=g?a-f:a+f,a>q&&(a=q),a<p&&(a=p),e-=l));"x"==d.scrollAxis?$(this).parent().css("top",a):$(this).parent().css("left",a);e/=h;a/=h;$(this).data("init-move",{dist:e,posi:a})});l.find("[data-animated]").each(function(){var c=$(this).data("animated"),a=+c.sdist*h||0,d=+c.edist*h||w,c=c.css3;b>a&&b<a+d?$(this).addClass("animated "+c):$(this).removeClass("animated "+c)})};this.naviScroll=function(b){v.find("a.active").each(function(){$(this).removeClass("active")});var d=0,
c=[],a;for(a in this.naviLoc)c[d]={},c[d].myNaviId=a,c[d].myNaviLoc=this.naviLoc[a]*h,d++;c=c.sort(function(a,b){return a.myNaviLoc<b.myNaviLoc?1:-1});for(d=0;d<c.length;d++)if(b>=c[d].myNaviLoc){var l=c[d].myNaviId;break}v.find("li a#"+l).addClass("active")};this.naviClick=function(b){function m(){var a="x"==d.scrollAxis?0==r.scrollLeft()&&0!=l.scrollLeft()?l.scrollLeft():r.scrollLeft():0==r.scrollTop()&&0!=l.scrollTop()?l.scrollTop():r.scrollTop();c.scrollPos=a;c.scrollUpdate(a,!1,!0)}var c=this;
v.find("a.active").each(function(){$(this).removeClass("active")});v.find("li a#"+b).addClass("active");"x"==d.scrollAxis?r.stop(!0,!0).animate({scrollLeft:this.naviLoc[b]*h},{duration:d.naviRatio,step:m,complete:m}):r.stop(!0,!0).animate({scrollTop:this.naviLoc[b]*h},{duration:d.naviRatio,step:m,complete:m})}}};z.init()};